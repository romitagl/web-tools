<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser PDF Merger</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }

        #file-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-name {
            flex-grow: 1;
            margin: 0 10px;
        }

        .file-controls button {
            margin-left: 5px;
            padding: 5px 10px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
        }

        #merge-btn {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        #merge-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>PDF/Image Merger</h1>
        <input type="file" id="file-input" multiple accept=".pdf,.jpg,.jpeg,.png">
        <ul id="file-list"></ul>
        <button id="merge-btn" disabled>Merge Files</button>
    </div>

    <script>
        const files = [];
        const fileList = document.getElementById('file-list');
        const mergeBtn = document.getElementById('merge-btn');
        const fileInput = document.getElementById('file-input');

        fileInput.addEventListener('change', handleFileSelect);
        mergeBtn.addEventListener('click', mergeFiles);

        async function handleFileSelect(e) {
            const newFiles = Array.from(e.target.files);
            files.push(...newFiles);
            renderFileList();
            mergeBtn.disabled = files.length === 0;
        }

        function renderFileList() {
            fileList.innerHTML = '';
            files.forEach((file, index) => {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <span class="file-name">${file.name}</span>
                    <div class="file-controls">
                        <button onclick="moveUp(${index})" ${index === 0 ? 'disabled' : ''}>↑</button>
                        <button onclick="moveDown(${index})" ${index === files.length - 1 ? 'disabled' : ''}>↓</button>
                        <button onclick="removeFile(${index})">×</button>
                    </div>
                `;
                fileList.appendChild(li);
            });
        }

        window.moveUp = (index) => {
            if (index > 0) {
                [files[index], files[index - 1]] = [files[index - 1], files[index]];
                renderFileList();
            }
        };

        window.moveDown = (index) => {
            if (index < files.length - 1) {
                [files[index], files[index + 1]] = [files[index + 1], files[index]];
                renderFileList();
            }
        };

        window.removeFile = (index) => {
            files.splice(index, 1);
            renderFileList();
            mergeBtn.disabled = files.length === 0;
        };

        async function mergeFiles() {
            try {
                const pdfDoc = await PDFLib.PDFDocument.create();
                
                for (const file of files) {
                    if (file.type === 'application/pdf') {
                        const pdfBytes = await file.arrayBuffer();
                        const externalPdf = await PDFLib.PDFDocument.load(pdfBytes);
                        const copiedPages = await pdfDoc.copyPages(externalPdf, 
                            externalPdf.getPageIndices());
                        copiedPages.forEach(page => pdfDoc.addPage(page));
                    } else if (file.type.startsWith('image/')) {
                        const imgBytes = await file.arrayBuffer();
                        const image = file.type === 'image/jpeg' 
                            ? await pdfDoc.embedJpg(imgBytes)
                            : await pdfDoc.embedPng(imgBytes);
                        
                        const page = pdfDoc.addPage([image.width, image.height]);
                        page.drawImage(image, {
                            x: 0,
                            y: 0,
                            width: image.width,
                            height: image.height,
                        });
                    }
                }

                const pdfBytes = await pdfDoc.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'merged-document.pdf';
                link.click();
            } catch (error) {
                alert(`Error merging files: ${error.message}`);
            }
        }
    </script>
</body>
</html>
